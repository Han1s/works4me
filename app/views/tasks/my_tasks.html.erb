<% @user = current_user %>
<h3>My Tasks</h3>
<hr>
<h3>Pending tasks waiting for a worker</h3>
<ul class="list-inline">
  <% Task.where(owner_user_id: @user, status: "pending").each do |task| %>
  <li class="list-inline-item">Name: <%=task.name%> for <%=humanized_money_with_symbol(task.price)%> - Status: <%= task.status%> for: <%= task.worker_user_id.nil? ? "not affected" : User.find(task.worker_user_id).first_name %>
  </li>
  <li class="list-inline-item">
    <%= form_for [task], method: :patch do |f| %>
    <%= hidden_field_tag :redirect_to, my_tasks_path %>
    <%= f.hidden_field :task_status, value: "canceled" %>
    <button type="submit"><i class="fas fa-trash"></i></button>
    <% end %>
  </li>
  <% end %>
</ul>
<hr>

<h3>Tasks accepted by a worker</h3>
<ul class="list-inline">
  <% Task.where(owner_user_id: @user, status: "accepted").each do |task| %>

  <li class="list-inline-item">Name: <%=task.name%> for <%=humanized_money_with_symbol(task.price)%> - Status: <%= task.status%> by: <%= task.worker_user_id.nil? ? "not affected" : User.find(task.worker_user_id).first_name.capitalize %> <%= User.find(task.worker_user_id).last_name.capitalize %>
  </li>

  <li class="list-inline-item">
    <%= form_for [task], method: :patch do |f| %>
    <%= hidden_field_tag :redirect_to, my_tasks_path %>
    <%= f.hidden_field :task_status, value: "confirmed" %>
    <button type="submit"><i class="fas fa-check-square"></i></button>
    <% end %>
  </li>
  <li class="list-inline-item">
    <%= form_for [task], method: :patch do |f| %>
    <%= hidden_field_tag :redirect_to, my_tasks_path %>
    <%= f.hidden_field :task_status, value: "rejected" %>
    <button type="submit"><i class="fas fa-user-slash"></i></button>
    <% end %>
  </li>
  <li class="list-inline-item">
    <%= form_for [task], method: :patch do |f| %>
    <%= hidden_field_tag :redirect_to, my_tasks_path %>
    <%= f.hidden_field :task_status, value: "canceled" %>
    <button type="submit"><i class="fas fa-trash"></i></button>
    <% end %>
  </li>

<!-- NOTE USE FOR THE MOMENT, BUT RETRIEVE RATING FOR A WORKER  -->
  <% if task.status == "accepted" && !task.worker_user_id.nil? %>
    <!-- PRINT REVIEWS FOR WORKER_ID   -->
    <% Review.where(user_id: task.worker_user_id).each do |review| %>
    <p>Rating of <%= review.rating %> for worker <%= User.find(review.user_id).first_name %> on <%= review.created_at.strftime("%d/%m/%Y - %-dh%d") %></p>
    <% end %>
    <% end %>
    <hr>
    <% end %>

</ul>

<!-- go back to the previous page if exists -->
<%= link_to "back", (request.referer.present? ? request.referer : root_path), class: "btn btn-primary" %>



